<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Campaignbay Developer Docs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../images/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" href="../images/favicon-192x192.png" sizes="192x192" />
    <link rel="apple-touch-icon" href="../images/favicon-180x180.png" />

    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/base.css?updated=1762860254">
    <link rel="stylesheet" href="../css/template.css?updated=1762860254">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/css/all.min.css" integrity="sha256-ybRkN9dBjhcS2qrW1z+hfCxq+1aBdwyQM5wlQoQVt/0=" crossorigin="anonymous" />
            <script src="https://cdn.jsdelivr.net/npm/css-vars-ponyfill@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0/js/all.min.js" integrity="sha256-0vuk8LXoyrmCjp1f0O300qo1M75ZQyhH9X3J6d+scmk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tarekraafat/autocomplete.js@7.2.0/dist/js/autoComplete.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8KCYZ2CYMS', {
		'content_group' : 'Campaignbay Developer Docs',
	});
</script>
        <script src="../js/prism.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            window.dispatchEvent(new HashChangeEvent('hashchange'));
        });
    </script>
</head>
<body id="top">
    <header class="phpdocumentor-top-header">
    <section class="phpdocumentor-section">
        <div class="site-branding">
            <a class="site-logo" href="../index.html"><img src="../images/logo.png" alt="CampaignBay" /></a>
        </div>
        <nav class="main-navigation">
            <ul>
                <li><a href="../hooks/hooks.html">Hooks Reference</a></li>
                <li><a href="https://docs.wpanchorbay.com/">Documentation</a></li>
            </ul>
        </nav>
    </section>
</header>

<div class="phpdocumentor-header">
    <section class="phpdocumentor-section">
        <h1 class="phpdocumentor-title"><a href="../index.html">Campaignbay Developer Docs</a></h1>
        <section class="phpdocumentor-search">
    <label class="phpdocumentor-label">
        <span class="visually-hidden">Search (click ESC to close search results)</span>
        <input id="autoComplete" tabindex="1" type="search" class="phpdocumentor-field phpdocumentor-search__field" placeholder="Loading..." disabled />
    </label>
</section>

    </section>
</div>

    <main class="phpdocumentor">
        <div class="phpdocumentor-section">
            <aside class="phpdocumentor-column -four phpdocumentor-sidebar">
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Namespaces</h2>
                                <h3 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/default.html"><abbr title="\">Global</abbr></a></h3>
                                        <h4 class="phpdocumentor-sidebar__root-namespace"><a href="../namespaces/wpabcampaignbay.html"><abbr title="\WpabCampaignBay">WpabCampaignBay</abbr></a></h4>
                <ul class="phpdocumentor-list">
                                            <li><a href="../namespaces/wpabcampaignbay-admin.html"><abbr title="\WpabCampaignBay\Admin">Admin</abbr></a></li>
                                            <li><a href="../namespaces/wpabcampaignbay-api.html"><abbr title="\WpabCampaignBay\Api">Api</abbr></a></li>
                                            <li><a href="../namespaces/wpabcampaignbay-core.html"><abbr title="\WpabCampaignBay\Core">Core</abbr></a></li>
                                            <li><a href="../namespaces/wpabcampaignbay-data.html"><abbr title="\WpabCampaignBay\Data">Data</abbr></a></li>
                                            <li><a href="../namespaces/wpabcampaignbay-engine.html"><abbr title="\WpabCampaignBay\Engine">Engine</abbr></a></li>
                                            <li><a href="../namespaces/wpabcampaignbay-helper.html"><abbr title="\WpabCampaignBay\Helper">Helper</abbr></a></li>
                                    </ul>
                        </section>

        <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Packages</h2>
                    <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/campaignbay.html"><abbr title="\campaignbay">campaignbay</abbr></a></h3>
                                <h3 class="phpdocumentor-sidebar__root-package"><a href="../packages/WPAB.html"><abbr title="\WPAB">WPAB</abbr></a></h3>
                        <ul class="phpdocumentor-list">
                                    <li><a href="../packages/WPAB-CampaignBay.html"><abbr title="\WPAB\CampaignBay">CampaignBay</abbr></a></li>
                            </ul>
                        </section>
    
    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Reports</h2>
                <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/deprecated.html">Deprecated</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/errors.html">Errors</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../reports/markers.html">Markers</a></h3>
    </section>

    <section class="phpdocumentor-sidebar__category">
        <h2 class="phpdocumentor-sidebar__category-header">Indices</h2>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../indices/files.html">Files</a></h3>
        <h3 class="phpdocumentor-sidebar__root-package"><a href="../hooks/hooks.html">Hooks Reference</a></h3>
    </section>
</aside>

            <div class="phpdocumentor-column -eight phpdocumentor-content">
                    <ul class="phpdocumentor-breadcrumbs">
    </ul>

    <article class="phpdocumentor-element -file">
        <h2 class="phpdocumentor-content__title">Woocommerce.php</h2>

                

        
                    <h3 class="phpdocumentor-elements__header" id="source-code">
                Source code
                <a href="#source-code" class="headerlink"><i class="fas fa-link"></i></a>
            </h3>
            <pre id="source-view" tabindex="-1" class="language-php line-numbers linkable-line-numbers"><code>&lt;?php
/**
 * The WooCommerce helper class.
 *
 * This file is responsible for defining the Woocommerce class, which acts as a
 * centralized wrapper for interacting with WooCommerce functions and data. It provides
 * a consistent and simplified API for the rest of the plugin to use.
 *
 * @link       https://campaignbay.github.io
 * @since      1.0.0
 *
 * @package    WPAB_CampaignBay
 * @subpackage WPAB_CampaignBay/Helper
 */

namespace WpabCampaignBay\Helper;

use WC_Order;
use WC_Order_Refund;
use WC_Product;
use WP_Post;
use WpabCampaignBay\Core\Common;
use WpabCampaignBay\Helper\Helper;

if (!defined(&#039;ABSPATH&#039;))
    exit; // Exit if accessed directly

/**
 * Woocommerce Class.
 *
 * This helper class provides a set of static methods to abstract and simplify
 * common interactions with the WooCommerce plugin. It serves as a central utility
 * for retrieving product data, getting order information, formatting prices, and
 * handling other WooCommerce-specific tasks in a consistent manner throughout the plugin.
 *
 * @since      1.0.0
 * @package    WPAB_CampaignBay
 * @subpackage WPAB_CampaignBay/Helper
 * @author     WP Anchor Bay &lt;wpanchorbay@gmail.com&gt;
 */
class Woocommerce
{
    /**
     * Check product type is found in product
     * @param $product - Woocommerce product object
     * @param $type - product types 
     * @return bool
     */
    static $product_taxonomy_terms = array();
    static $custom_taxonomies;
    static $checkout_post = null;

    protected static $products = array();
    protected static $product_variations = array();

    static function product_type_is($product, $type)
    {
        if (!empty($product))
            if (is_object($product) &amp;&amp; method_exists($product, &#039;is_type&#039;)) {
                return $product-&gt;is_type($type);
            }
        return false;
    }

    static function get_price_html($price_html, $product, $original_price, $discount_price, $display_as_regular_price = false)
    {
        if ($display_as_regular_price || $original_price &lt;= $discount_price) {
            return self::format_price($discount_price);
        }
        $new_price_html = self::format_sale_price(self::format_price($original_price), self::format_price($discount_price));
        if ($new_price_html)
            return $new_price_html;
        return $price_html;
    }

    static function generate_product_banner($value, $type = &#039;&#039;, $format = null)
    {
        if ($value === null || $value === &#039;&#039; || $type === null || $type === &#039;&#039;)
            return null;
        if ($format === null || $format === &#039;&#039;) {
            $format = Common::get_instance()-&gt;get_settings(
                $type == &#039;percentage&#039; ? &#039;product_message_format_percentage&#039; : &#039;product_message_format_fixed&#039;
            );
        }
        return Helper::generate_message($format, array(
            &#039;{percentage_off}&#039; =&gt; $value,
            &#039;{amount_off}&#039; =&gt; $value . self::get_currency_symbol(),
        ));
    }

    /**
     * Add notice
     *
     * @access public
     * @param $message string
     * @param $type string
     * @param $data array
     */
    public static function wc_add_notice($message, $type = &#039;success&#039;, $data = array())
    {
        if (function_exists(&#039;wc_add_notice&#039;)) {
            wc_add_notice($message, $type, $data);
        }
    }

    static function round($value)
    {
        if (function_exists(&#039;wc_get_price_decimals&#039;)) {
            return round($value, wc_get_price_decimals());
        } else {
            return round($value, get_option(&#039;woocommerce_price_num_decimals&#039;, 2));
        }
    }
    /**
     * Format the sale price
     * @param $price1
     * @param $price2
     * @return string|null
     */
    static function format_sale_price($price1, $price2)
    {
        if (function_exists(&#039;wc_format_sale_price&#039;)) {

            /**
             * Filters the HTML output for a sale price display (strikethrough price).
             *
             * This hook allows developers to completely override the final HTML string for a
             * product&#039;s sale price as formatted by the plugin. It passes the original regular
             * and sale prices, allowing for custom formatting, different separators, or the
             * addition of extra HTML elements.
             *
             * @since 1.0.0
             * @hook  campaignbay_format_sale_price
             *
             * @param string      $html_price    The default sale price HTML (e.g., &#039;&lt;del&gt;...&lt;/del&gt;&lt;ins&gt;...&lt;/ins&gt;&#039;).
             * @param string|float $regular_price The product&#039;s regular price.
             * @param string|float $sale_price    The product&#039;s sale price.
             *
             * @return string The modified sale price HTML.
             */
            return apply_filters(&#039;campaignbay_format_sale_price&#039;, wc_format_sale_price($price1, $price2), $price1, $price2);
        }
        return NULL;
    }

    /**
     * Get variation prices for variable product
     * @param \WC_Product_Variable $product
     * @param bool $for_display
     * @return array|false
     */
    static function get_variation_prices($product, $for_display = false)
    {
        if (is_object($product) &amp;&amp; method_exists($product, &#039;get_variation_prices&#039;)) {
            return $product-&gt;get_variation_prices($for_display);
        }
        return false;
    }

    /**
     * format the price
     * @param $price
     * @param $args
     * @return string
     */
    static function format_price($price, $args = array())
    {
        if (function_exists(&#039;wc_price&#039;)) {
            return wc_price($price, $args);
        }
        return $price;
    }

    /**
     * format currency code
     * @return string
     */
    static function get_currency_symbol($code = &#039;&#039;)
    {
        if (function_exists(&#039;get_woocommerce_currency_symbol&#039;)) {
            return get_woocommerce_currency_symbol($code);
        }
        return $code;
    }
    /**
     * get the parent id of the particular product
     * @param $product
     * @return int
     */
    static function get_product_parent_id($product)
    {
        $parent_id = 0;
        if (is_int($product)) {
            $product = self::get_product($product);
        }
        if (!empty($product))
            if (is_object($product) &amp;&amp; method_exists($product, &#039;get_parent_id&#039;)) {
                $parent_id = $product-&gt;get_parent_id();
            }
        /**
         * Filters the parent ID of a given product.
         *
         * This hook is used primarily to identify the main variable product ID from a
         * variation object. Developers can use this filter to provide a custom parent ID,
         * which is useful for complex product types like bundles or composites that may
         * have their own unique parent/child relationships.
         *
         * @since 1.0.0
         * @hook  campaignbay_get_product_parent_id
         *
         * @param int        $parent_id The determined parent ID (0 if not a variation).
         * @param WC_Product $product   The product object being checked.
         *
         * @return int The filtered parent ID.
         */
        return apply_filters(&#039;campaignbay_get_product_parent_id&#039;, $parent_id, $product);
    }

    /**
     * print the notice
     * @param $message
     * @param $type
     */
    static function print_notice($message, $type)
    {
        if (function_exists(&#039;wc_print_notice&#039;)) {
            wc_print_notice(wp_unslash($message), $type);
        }
    }
    /**
     * get available product variations
     * @param $product
     * @return array
     */
    public static function available_product_variations($product)
    {
        $product_id = self::get_product_id($product);
        if (isset(self::$product_variations[$product_id])) {
            return self::$product_variations[$product_id];
        }
        $available_variations = array();
        $is_variable_product = self::product_type_is($product, &#039;variable&#039;);
        if (!empty($product))
            if ($is_variable_product &amp;&amp; is_object($product) &amp;&amp; method_exists($product, &#039;get_available_variations&#039;)) {
                $available_variations = $product-&gt;get_available_variations();
            }
        self::$product_variations[$product_id] = $available_variations;
        return $available_variations;
    }


    /**
     * get the product ID
     * @param $product - woocommerce product object
     * @return null
     */
    static function get_product_id($product)
    {
        if (!empty($product)) {
            if (is_object($product) &amp;&amp; method_exists($product, &#039;get_id&#039;)) {
                return $product-&gt;get_id();
            } elseif (isset($product-&gt;id)) {
                $product_id = $product-&gt;id;
                if (isset($product-&gt;variation_id)) {
                    $product_id = $product-&gt;variation_id;
                }
                return $product_id;
            } else {
                return NULL;
            }
        }
        return NULL;
    }
    /**
     * get the product ID or parent ID if variation
     * @param $product - woocommerce product object
     * @return null
     */
    static function get_product_or_parent_id($product)
    {
        if (self::product_type_is($product, &#039;variation&#039;)) {
            return self::get_product_parent_id($product);
        }
        return self::get_product_id($product);
    }



    /**
     * Get the product from product id
     * @param $product_id
     * @return bool|false|WC_Product|null
     */
    static function get_product($product_id)
    {
        if (isset(self::$products[$product_id])) {
            return self::$products[$product_id];
        } else if (function_exists(&#039;wc_get_product&#039;)) {
            /**
             * Filters the WooCommerce product object retrieved by the plugin.
             *
             * This hook is applied after the plugin fetches a product object using `wc_get_product()`.
             * It allows developers to intercept and modify the product object before it is used
             * in any of the plugin&#039;s internal calculations or caching mechanisms. This can be used
             * for advanced scenarios, such as substituting a different product object for testing
             * or complex bundling logic.
             *
             * @since 1.0.0
             * @hook  campaignbay_get_product
             *
             * @param WC_Product|false $product_object The retrieved product object, or false if not found.
             * @param int              $product_id     The ID of the product that was requested.
             *
             * @return WC_Product|false The filtered product object.
             */
            self::$products[$product_id] = apply_filters(&#039;campaignbay_get_product&#039;, wc_get_product($product_id), $product_id);

            return self::$products[$product_id];
        }
        return false;
    }


    /**
     * Get the sale price of the product
     * @param $product
     * @return bool
     */
    static function get_product_sale_price($product)
    {
        if (!empty($product))
            if (self::is_product_in_sale($product)) {
                if (is_object($product) &amp;&amp; method_exists($product, &#039;get_sale_price&#039;)) {
                    $price = $product-&gt;get_sale_price();
                    return $price;
                }
                return false;
            }
        return false;
    }

    /**
     * Check the produt in sale
     * @param $product
     * @return bool
     */
    static function is_product_in_sale($product)
    {
        if (!empty($product))
            if (is_object($product) &amp;&amp; method_exists($product, &#039;is_on_sale&#039;) &amp;&amp; method_exists($product, &#039;get_sale_price&#039;)) {
                if ($product-&gt;is_on_sale(&#039;&#039;)) {
                    if ($product-&gt;get_sale_price()) {
                        return true;
                    } else {
                        return false;
                    }
                }
            }
        return false;
    }

    /**
     * Get the regular price of the product
     * @param $product
     * @return bool
     */
    static function get_product_regular_price($product)
    {
        if (!empty($product))
            if (is_object($product) &amp;&amp; method_exists($product, &#039;get_regular_price&#039;)) {
                $price = $product-&gt;get_regular_price();
                return $price;
            }
        return false;
    }

    /**
     * Get the base price of the product
     * @param $product
     * @return bool
     */
    static function get_product_base_price($product)
    {
        $price = null;
        if (empty($product))
            return $price;
        $settings = Common::get_instance()-&gt;get_settings(&#039;global_calculate_discount_from&#039;);
        if ($settings == &#039;sale_price&#039; &amp;&amp; self::is_product_in_sale($product)) {
            $price = self::get_product_sale_price($product);
            if ($price !== false) {
                return $price;
            }
        }
        $price = self::get_product_regular_price($product);
        if ($price === false) {
            $price = self::get_product_sale_price($product);
        }
        return $price;
    }
}</code></pre>
            </article>
            </div>
        </div>
        <a href="#top" class="phpdocumentor-back-to-top"><i class="fas fa-chevron-circle-up"></i></a>

    </main>

    <footer class="phpdocumentor phpdocumentor-footer">
    <div class="phpdocumentor-section">
        <span>Campaignbay developer documentation generated by <a href="http://www.phpdoc.org/">phpDocumentor</a> on November 11th, 2025 at 11:24 am.</span>
    </div>
</footer>

    <script>
        cssVars({});
    </script>
    <script>
        var searchParams = {
            'searchIndex': '..\/js\/searchIndex.json'
        };
    </script>
    <script src="../js/searchIndex.js?updated=1762860254"></script>
    <script src="../js/search.js?updated=1762860254"></script>
</body>
</html>
